[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Um Curso Pr√°tico Sobre Acessibilidade Urbana em R",
    "section": "",
    "text": "1 Introdu√ß√£o √† oficina\nEste site apresenta o material de apoio para a oficina ‚ÄúUm Curso Pr√°tico Sobre Acessibilidade Urbana em R‚Äù. A oficina ser√° realizada como parte da programa√ß√£o do 38o Congresso de Pesquisa e Ensino em Transportes, em Florian√≥polis, entre os dias 4 e 8 de novembro de 2024. A oficina √© patrocinada pela Associa√ß√£o Nacional de Pesquisa e Ensino em Transportes (ANPET).",
    "crumbs": [
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introdu√ß√£o √† oficina</span>"
    ]
  },
  {
    "objectID": "index.html#bio-do-instrutor",
    "href": "index.html#bio-do-instrutor",
    "title": "Um Curso Pr√°tico Sobre Acessibilidade Urbana em R",
    "section": "4.1 Bio do instrutor:",
    "text": "4.1 Bio do instrutor:\nRafael H. M. Pereira √© pesquisador s√™nior nas √°reas de planejamento urbano, ci√™ncia de dados espaciais e mobilidade urbana no Instituto de Pesquisa Econ√¥mica Aplicada (Ipea), e professor visitante da Universidade de Toronto. Sua pesquisa investiga como as pol√≠ticas urbanas e tecnologias moldam a organiza√ß√£o espacial das cidades, a mobilidade humana, bem como seus impactos nas desigualdades sociais e de sa√∫de. Algumas de suas contribui√ß√µes nos campos de urban analytics e planejamento envolvem o desenvolvimento de novos m√©todos e ferramentas computacionais de c√≥digo aberto para o estudo de sistemas urbanos e redes de transporte. Essas contribui√ß√µes partem de interesses substantivos sobre quest√µes de equidade no planejamento urbano, desigualdades de acesso a oportunidades, e dos impactos ambientais gerados pelo ambiente constru√≠do e por padr√µes de mobilidade. Com gradua√ß√£o em sociologia pela UnB e mestrado em demografia pela Unicamp, Rafael Pereira obteve seu PhD em geografia pela Universidade de Oxford.\n\n\n\n\nKarner, Alex, Rafael H. M. Pereira, and Steven Farber. 2024. ‚ÄúAdvances and Pitfalls in Measuring Transportation Equity.‚Äù Transportation, January. https://doi.org/10.1007/s11116-023-10460-7.\n\n\nLevinson, David, and David King. 2020. Transport Access Manual: A Guide for Measuring Connection Between People and Places. Committee of the Transport Access Manual, University of Sydney. https://ses.library.usyd.edu.au/handle/2123/23733.\n\n\nPereira, Rafael H. M., and Daniel Herszenhut. 2023. Introduction to Urban Accessibility: A Practical Guide with r. 1st ed. Instituto de Pesquisa Econ√¥mica Aplicada (Ipea). https://doi.org/10.38116/9786556350653.\n\n\nPereira, Rafael H. M., Marcus Saraiva, Daniel Herszenhut, Carlos Kaue Vieira Braga, and Matthew Wigginton Conway. 2021. ‚ÄúR5r: Rapid Realistic Routing on Multimodal Transport Networks with R5 in R.‚Äù Transport Findings, March, 21262. https://doi.org/10.32866/001c.21262.",
    "crumbs": [
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introdu√ß√£o √† oficina</span>"
    ]
  },
  {
    "objectID": "2.1_installation.html",
    "href": "2.1_installation.html",
    "title": "2¬† Instala√ß√£o",
    "section": "",
    "text": "2.1 Instalando R e RStudio\nAssumimos que voc√™ j√° tenha o R e o RStudio instalados em sua m√°quina. Caso n√£o tenha, siga estas instru√ß√µes simples aqui.",
    "crumbs": [
      "2. Getting started",
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Instala√ß√£o</span>"
    ]
  },
  {
    "objectID": "2.1_installation.html#instalando-pacotes-de-r",
    "href": "2.1_installation.html#instalando-pacotes-de-r",
    "title": "2¬† Instala√ß√£o",
    "section": "2.2 Instalando pacotes de R",
    "text": "2.2 Instalando pacotes de R\nO workshop utiliza alguns pacotes em R que precisam ser instalados em sua m√°quina. A maneira mais simples de fazer isso √© executando o c√≥digo abaixo. Isso pode levar alguns minutos se for a primeira vez que voc√™ instala esses pacotes.\n\npkgs &lt;- c(\n  'r5r',\n  'accessibility',\n  'rJavaEnv',\n  'ggplot2',\n  'mapview',\n  'quantreg',\n  'dplyr',\n  'h3jsr',\n  'sf'\n  )\n\ninstall.packages(pkgs)",
    "crumbs": [
      "2. Getting started",
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Instala√ß√£o</span>"
    ]
  },
  {
    "objectID": "2.1_installation.html#instalando-java",
    "href": "2.1_installation.html#instalando-java",
    "title": "2¬† Instala√ß√£o",
    "section": "2.3 Instalando Java",
    "text": "2.3 Instalando Java\nPara usar o pacote {r5r} (vers√£o v2.0 ou superior), voc√™ precisar√° ter o Java Development Kit (JDK) 21 instalado em seu computador. Existem diversas implementa√ß√µes de JDK de c√≥digo aberto. A maneira mais f√°cil de instalar o JDK √© utilizando o novo pacote {rJavaEnv} no R, desenvolvido por Egor Kotov (obrigado, Egor!).\n\n# checa se tem alguma versao do Java instalado \nrJavaEnv::java_check_version_rjava()\n\n## se esta √© a primeira vez que voc√™ usa o {rJavaEnv}, talvez seja \n## necess√°rio executar o c√≥digo abaixo para consentir a instala√ß√£o do Java\nrJavaEnv::rje_consent(provided = TRUE)\n\n# instala Java 21\nrJavaEnv::java_quick_install(version = 21)\n\n# check if Java was successfully installed\nrJavaEnv::java_check_version_rjava()\n\nAlternativamente, voc√™ pode baixar e instalar manualmente qualquer uma dessas implementa√ß√µes de JDK:\n\nAdoptium/Eclipse Temurin\nAmazon Corretto\nOracle OpenJDK\n\nAqui est√£o alguns slides complementares explicando os requisitos computacionais para realizar an√°lises de roteamento e acessibilidade de transporte com R.",
    "crumbs": [
      "2. Getting started",
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Instala√ß√£o</span>"
    ]
  },
  {
    "objectID": "2.2_data_requirements.html",
    "href": "2.2_data_requirements.html",
    "title": "3¬† Dados necess√°rios",
    "section": "",
    "text": "3.1 Rede vi√°ria",
    "crumbs": [
      "2. Getting started",
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Dados necess√°rios</span>"
    ]
  },
  {
    "objectID": "2.2_data_requirements.html#rede-vi√°ria",
    "href": "2.2_data_requirements.html#rede-vi√°ria",
    "title": "3¬† Dados necess√°rios",
    "section": "",
    "text": "Rede vi√°ria (mandatory):\n\n{osmextract}, pacaote de R;\nGeofabrik, website;\nHOT Export Tool, website;\nBBBike Extract Service, website.\nProtomaps website",
    "crumbs": [
      "2. Getting started",
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Dados necess√°rios</span>"
    ]
  },
  {
    "objectID": "2.2_data_requirements.html#rede-de-transporte-p√∫blico",
    "href": "2.2_data_requirements.html#rede-de-transporte-p√∫blico",
    "title": "3¬† Dados necess√°rios",
    "section": "3.2 Rede de transporte p√∫blico",
    "text": "3.2 Rede de transporte p√∫blico\n\nRede de transporte p√∫blico (optional):\n\n{tidytransit},pacote de R;\nTransitland, website;\nMobility Database website",
    "crumbs": [
      "2. Getting started",
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Dados necess√°rios</span>"
    ]
  },
  {
    "objectID": "2.2_data_requirements.html#topografia",
    "href": "2.2_data_requirements.html#topografia",
    "title": "3¬† Dados necess√°rios",
    "section": "3.3 Topografia",
    "text": "3.3 Topografia\n\nTopografia (opcional):\n\n{elevatr}, pacote de R;\nNasa‚Äôs SRTMGL1, website.",
    "crumbs": [
      "2. Getting started",
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Dados necess√°rios</span>"
    ]
  },
  {
    "objectID": "3.1_quick_approach.html",
    "href": "3.1_quick_approach.html",
    "title": "4¬† Aborgadem r√°pida",
    "section": "",
    "text": "4.1 Allocating memory to Java & loading packages\nFirst, let‚Äôs increase the memory available to run Java, which is used by the underlying R5 routing engine. To increase the available memory to 2 GB, for example, we use the following command. Note that this needs to be run before loading the packages that will be used in our analysis.\noptions(java.parameters = \"-Xmx2G\")\nNow we can load the packages we‚Äôll use in this section:\nlibrary(r5r)\nlibrary(h3jsr)\nlibrary(dplyr)\nlibrary(mapview)\nlibrary(ggplot2)",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Aborgadem r√°pida</span>"
    ]
  },
  {
    "objectID": "3.1_quick_approach.html#a-quick-look-at-our-sample-data",
    "href": "3.1_quick_approach.html#a-quick-look-at-our-sample-data",
    "title": "4¬† Aborgadem r√°pida",
    "section": "4.2 A quick look at our sample data",
    "text": "4.2 A quick look at our sample data\nOur case study is the city of Porto Alegre, Brazil. The {r5r} package brings a small sample data for this city, including the following files:\n\nAn OpenStreetMap network: poa_osm.pbf\nTwo public transport GTFS feeds: poa_eptc.zip (buses) and poa_trensurb.zip (trains)\nA raster elevation data: poa_elevation.tif\nA data frame with land use data: poa_hexgrid.csv file with the centroids of a regular hexagonal grid covering the sample area. The data frame also indicates the number of residents and schools in each cell. We‚Äôll use these points as origins and destinations in our analysis.\n\nThese data sets should be saved in a single directory (our data_path). Here‚Äôs how the land use data looks like:\n\n# path to data directory\ndata_path &lt;- system.file(\"extdata/poa\", package = \"r5r\")\n\n# read points data\npoints &lt;- read.csv(file.path(data_path, \"poa_hexgrid.csv\"))\nhead(points)\n\n               id       lon       lat population schools jobs healthcare\n1 89a901291abffff -51.15825 -30.05385          0       0 1214          0\n2 89a9012a3cfffff -51.21187 -30.10058        159       0    0          0\n3 89a901295b7ffff -51.16521 -30.07544       1008       0    3          1\n4 89a901284a3ffff -51.20535 -30.09005         92       0    0          0\n5 89a9012809bffff -51.19575 -30.07839        577       0    9          0\n6 89a901285cfffff -51.21108 -30.08124       1170       0  427          0\n\n\nüîé To visualize the spatial distribution of these data, we can retrieve the geometry of the H3 hexagonal grid and explore it using an interactive map:\n\n# retrieve polygons of H3 spatial grid\ngrid &lt;- h3jsr::cell_to_polygon(\n  points$id,\n  simple = FALSE\n  )\n\n# merge spatial grid with land use data\ngrid_poa &lt;- left_join(\n  grid,\n  points,\n  by = c('h3_address'='id')\n  )\n\n# interactive map\nmapview(grid_poa, zcol = 'population')",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Aborgadem r√°pida</span>"
    ]
  },
  {
    "objectID": "3.1_quick_approach.html#building-a-routable-transport-network",
    "href": "3.1_quick_approach.html#building-a-routable-transport-network",
    "title": "4¬† Aborgadem r√°pida",
    "section": "4.3 Building a routable transport network",
    "text": "4.3 Building a routable transport network\nThis quick approach to calculate accessibility involves only 2 steps. The first step is to build the multimodal transport network using the r5r::setup_r5() function.\n\nr5r_core &lt;- r5r::setup_r5(data_path, \n                          verbose = FALSE)\n\nAs you can see, we only need to pass the path to our data directory to the r5r::setup_r5() function. The function then combines the OSM, GTFS and elevation data in this directory to create a graph that is used for routing trips between origin-destination pairs and, consequently, for calculating travel time matrices and accessibility.",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Aborgadem r√°pida</span>"
    ]
  },
  {
    "objectID": "3.1_quick_approach.html#calculating-access-quick-approach",
    "href": "3.1_quick_approach.html#calculating-access-quick-approach",
    "title": "4¬† Aborgadem r√°pida",
    "section": "4.4 Calculating access: quick approach",
    "text": "4.4 Calculating access: quick approach\nIn the second step, you can calculate accessibility estimates in a single call using the r5r::accessibility() function. It includes different options of decay functions to compute cumulative accessibility measures and different gravity-based metrics.\nIn this example, we calculate the cumulative accessibility of the number of schools and hospitals accessible in less than 20 minutes by public transport. Thus, we‚Äôll be using decay_function = \"step\".\nNote that to use r5r::accessibility(), the input of points must be a data.frame with columns indicating:\n\nthe id of each location\nspatial coordinates lat and lon\nthe number of activities in each location. The name of this column has to be passed to the opportunities_colnames parameter.\n\n\n# routing inputs\nmode &lt;- c(\"walk\", \"transit\")\n1max_walk_time &lt;- 30\ntravel_time_cutoff &lt;- 20\ndeparture_datetime &lt;- as.POSIXct(\"13-05-2019 14:00:00\",\n                                 format = \"%d-%m-%Y %H:%M:%S\")\n\n# calculate accessibility\naccess1 &lt;- r5r::accessibility(\n  r5r_core = r5r_core,\n  origins = points,\n  destinations = points,\n  mode = mode,\n2  opportunities_colnames = c(\"schools\", \"healthcare\"),\n  decay_function = \"step\",\n3  cutoffs = travel_time_cutoff,\n  departure_datetime = departure_datetime,\n  max_walk_time = max_walk_time,\n  progress = TRUE\n  )\n\n\n1\n\nIn minutes\n\n2\n\nNote you can pass the columns of more than one type of opportunity.\n\n3\n\nSimilarly, you could pass more than one time threshold.\n\n\n\n\n\n\n\n\n\n\nTip\n\n\n\nNote that the r5r::accessibility() function has several additional parameters that allow you to specify different characteristics of trips, including a maximum trip duration, walking and cycling speed, level of traffic stress (LTS), etc. For more info, check the documentation of the function by calling ?r5r::accessibility in your R Console or check the documentation on {r5r} website.\n\n\nThe output is a data.frame that shows for every origin id the number of opportunities that can be reached:\n\nhead(access1)\n\n                id opportunity percentile cutoff accessibility\n            &lt;char&gt;      &lt;char&gt;      &lt;int&gt;  &lt;int&gt;         &lt;num&gt;\n1: 89a901291abffff     schools         50     20             3\n2: 89a901291abffff  healthcare         50     20             6\n3: 89a9012a3cfffff     schools         50     20             0\n4: 89a9012a3cfffff  healthcare         50     20             0\n5: 89a901295b7ffff     schools         50     20             6\n6: 89a901295b7ffff  healthcare         50     20             4",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Aborgadem r√°pida</span>"
    ]
  },
  {
    "objectID": "3.1_quick_approach.html#accessibility-map",
    "href": "3.1_quick_approach.html#accessibility-map",
    "title": "4¬† Aborgadem r√°pida",
    "section": "4.5 Accessibility map",
    "text": "4.5 Accessibility map\nNow it is super simple to merge these accessibility estimates to our spatial grid to visualize these results on a map.\n\n# merge spatial grid with accessibility estimates\naccess_sf &lt;- left_join(\n  grid, \n  access1, \n  by = c('h3_address'='id')\n  )\n\n# plot\nggplot() +\n  geom_sf(data = access_sf, aes(fill = accessibility), color= NA) +\n  scale_fill_viridis_c(direction = -1, option = 'B') +\n  labs(title = 'Number of schools and hospitals accessible by public transport in 20 minutes',\n       fill = 'Number of\\nfacilities') +\n  theme_minimal() +\n  theme(axis.title = element_blank()) +\n  facet_wrap(~opportunity) +\n  theme_void()",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Aborgadem r√°pida</span>"
    ]
  },
  {
    "objectID": "3.2_flexible_approach.html",
    "href": "3.2_flexible_approach.html",
    "title": "5¬† Aborgadem flexivel",
    "section": "",
    "text": "5.1 Building a routable transport network\nFirst, we build the multimodal transport network by passing the path of our data directory to the r5r::setup_r5() function.\n# path to data directory\ndata_path &lt;- system.file(\"extdata/poa\", package = \"r5r\")\n\n# build network\nr5r_core &lt;- r5r::setup_r5(data_path, \n                          verbose = FALSE)",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>Aborgadem flexivel</span>"
    ]
  },
  {
    "objectID": "3.2_flexible_approach.html#computing-a-travel-time-matrix",
    "href": "3.2_flexible_approach.html#computing-a-travel-time-matrix",
    "title": "5¬† Aborgadem flexivel",
    "section": "5.2 Computing a travel time matrix",
    "text": "5.2 Computing a travel time matrix\nThe second step is to calculate a travel time matrix with door-to-door travel time estimates from all origins to all destinations. To do this, we use the r5r::travel_time_matrix() function.\nAs basic inputs, this function receives the routable network created above, origin and destination points as data.frames with columns id, lon and lat, the transportation mode and the departure time.\n\n# read points data\npoints &lt;- read.csv(file.path(data_path, \"poa_hexgrid.csv\"))\n\n# routing inputs\nmode &lt;- c(\"walk\", \"transit\")\n1max_trip_duration &lt;- 30\ndeparture_datetime &lt;- as.POSIXct(\"13-05-2019 14:00:00\",\n                                 format = \"%d-%m-%Y %H:%M:%S\")\n\n# calculate travel time matrix\nttm &lt;- r5r::travel_time_matrix(\n  r5r_core = r5r_core,\n  origins = points,\n  destinations = points,\n  mode = mode,\n  departure_datetime = departure_datetime,\n  max_trip_duration = max_trip_duration,\n  progress = TRUE\n  )\n\n\n1\n\nIn minutes\n\n\n\n\n\n\n\n\n\n\nTip\n\n\n\nNote that the r5r::travel_time_matrix() includes several additional parameters that allow you to specify some trip characteristics, such as maximum walking time, a departure time window, the maximum number of public transport legs allowed, etc. For more info, check the documentation of the function by calling ?r5r::travel_time_matrix in your R Console or check the documentation on {r5r} website.\n\n\nThe output is a data.frame, which looks like this. It is a matrix in long format with the columns from_id, to_id and a third column indicating the travel time (in minutes) for each origin-destination pair.\n\nhead(ttm)\n\n           from_id           to_id travel_time_p50\n            &lt;char&gt;          &lt;char&gt;           &lt;int&gt;\n1: 89a901291abffff 89a901291abffff               1\n2: 89a901291abffff 89a90129157ffff              25\n3: 89a901291abffff 89a9012956bffff              29\n4: 89a901291abffff 89a90128257ffff              29\n5: 89a901291abffff 89a90129ed3ffff              29\n6: 89a901291abffff 89a9012913bffff              19\n\n\n\n\n\n\n\n\nProcessing speed\n\n\n\nThe travel_time_matrix() function uses an extension of the RAPTOR routing algorithm (Conway, Byrd, and van der Linden 2017), making R5 extremely fast. Depending on the number of origin-destination pairs, {r5r} can calculate travel time matrices between 6 and 200 times faster than other multimodal routing engines (Higgins et al. 2022).",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>Aborgadem flexivel</span>"
    ]
  },
  {
    "objectID": "3.2_flexible_approach.html#calculating-accessibility",
    "href": "3.2_flexible_approach.html#calculating-accessibility",
    "title": "5¬† Aborgadem flexivel",
    "section": "5.3 Calculating accessibility",
    "text": "5.3 Calculating accessibility\n\nHaving computed a travel time matrix, we can combine it with land use data to calculate accessibility. For this, we will use the {accessibility} package, which provides some fast and convenient functions to calculate several accessibility measures.\nThe package currently includes more than 7 different types of accessibility measures (see details in the package documentation website).\n\ncost_to_closest(): Minimum travel cost to closest N number of opportunities\ncumulative_cutoff(): Cumulative access based on a travel cost cutoff\ncumulative_interval(): Cumulative access based on a travel time interval\ngravity(): Gravity-based accessibility measures\nfloating_catchment_area(): Floating catchment area accessibility\nspatial_availability(): Spatial availability\nbalancing_cost(): Balancing cost accessibility measure\n\nAs basic inputs, all functions of the package require a pre-calculated cost matrix (in our case, a travel time matrix) and some land use data with the number of opportunities (e.g.¬†schools, jobs) in each cell of the study area. Both inputs must be organized in a data.frame format. We have just seen above the structure of the travel matrix. The land use data.frame must be organized like this:\n\n# land use data\n1head(points)\n\n\n1\n\nThe land use data must contain an id column, referring to the ids listed in the travel matrix, and the number of opportunities in each location.\n\n\n\n\n               id       lon       lat population schools jobs healthcare\n1 89a901291abffff -51.15825 -30.05385          0       0 1214          0\n2 89a9012a3cfffff -51.21187 -30.10058        159       0    0          0\n3 89a901295b7ffff -51.16521 -30.07544       1008       0    3          1\n4 89a901284a3ffff -51.20535 -30.09005         92       0    0          0\n5 89a9012809bffff -51.19575 -30.07839        577       0    9          0\n6 89a901285cfffff -51.21108 -30.08124       1170       0  427          0\n\n\nNow let‚Äôs calculate a few accessibility indicators.\n\n5.3.1 Cumulative accessibility measure\n\n5.3.1.1 Threshold-based cumulative accessibility\nTo calculate a traditional cumulative accessibility measure, we can use the accessibility::cumulative_cutoff() function. Along with the travel matrix and land use data sets, we only need to pass the name of the column with the travel time values, the name of the column with the count of opportunities, and a travel time cutoff.\nHere, we calculate the number of schools accessible in 20 minutes.\n\n# threshold-based cumulative accessibility\naccess_cum_t &lt;- accessibility::cumulative_cutoff(\n  travel_matrix = ttm, \n  land_use_data = points,\n  travel_cost = 'travel_time_p50',\n  opportunity = 'schools',\n  cutoff = 20\n  )\n  \nhead(access_cum_t)\n\n                id schools\n            &lt;char&gt;   &lt;int&gt;\n1: 89a9012124fffff       1\n2: 89a9012126bffff       3\n3: 89a9012127bffff       3\n4: 89a90128003ffff       8\n5: 89a90128007ffff       6\n6: 89a9012800bffff       9\n\n\n\n\n5.3.1.2 Interval-based cumulative accessibility\nPrevious studies have shown that the ad-hoc choice of a single travel time threshold can substantially influence the results of traditional cumulative accessibility measures, introducing bias into transport project evaluations and equity analyses (Pereira 2019). To overcome this issue, we have proposed a time interval cumulative accessibility measure (Tomasiello et al. 2023). This new metric estimates the average (or the median) number of opportunities that can be reached considering multiple minute-by-minute cutoffs within a given travel time interval.\nThe main advantage of this metric is that it mitigates the impacts of arbitrary choices of trip duration on accessibility analysis while preserving the computation and communicability advantages of threshold-based cumulative measures.\nHere, we calculate the average number of schools that can be reached between 20 and 30 minutes.\n\n# interval-based cumulative accessibility\naccess_cum_i &lt;- accessibility::cumulative_interval(\n  travel_matrix = ttm, \n  land_use_data = points,\n  travel_cost = 'travel_time_p50',\n  opportunity = 'schools',\n  interval = c(15,25),\n  summary_function = mean\n  )\n  \nhead(access_cum_i)\n\n                id schools\n            &lt;char&gt;   &lt;int&gt;\n1: 89a9012124fffff       1\n2: 89a9012126bffff       4\n3: 89a9012127bffff       4\n4: 89a90128003ffff       7\n5: 89a90128007ffff       7\n6: 89a9012800bffff       9\n\n\n\n\n\n\n5.3.2 Gravity-based accessibility measures\nThe package also includes accessibility::gravity() to calculate gravity-based accessibility metrics in a very flexible way.\nIt includes a decay_function parameter that can receive any function to convert travel cost into an impedance factor used to weight opportunities. For convenience, the package currently includes the following functions:\n\ndecay_binary()\ndecay_exponential()\ndecay_linear()\ndecay_logistic()\ndecay_power()\ndecay_stepped()\n\nLet‚Äôs see a couple examples with logistic and negative exponential decay functions:\n\n# logistic decay\naccess_lgst &lt;- gravity(\n  travel_matrix = ttm,\n  land_use_data = points,\n  decay_function = decay_logistic(cutoff = 15, sd = 5),\n  opportunity = \"schools\",\n  travel_cost = \"travel_time_p50\"\n)\n\n# negative exponential decay\naccess_nexp &lt;- gravity(\n  travel_matrix = ttm,\n  land_use_data = points,\n  decay_function = decay_exponential(decay_value = 0.1),\n  opportunity = \"schools\",\n  travel_cost = \"travel_time_p50\"\n)\n\nHere‚Äôs a quick visualization of the shape of the decay curves we‚Äôve used.\n\n\nCode\nnegative_exp &lt;- decay_exponential(decay_value = 0.1)\nlogistic &lt;- decay_logistic(cutoff = 15, sd = 5)\n\ntravel_costs &lt;- seq(0, 30, 0.1)\n\nweights &lt;- data.frame(\n  minutes = travel_costs,\n  negative_exp = negative_exp(travel_costs)[[\"0.1\"]],\n  logistic = logistic(travel_costs)[[\"c15;sd5\"]]\n)\n\n# reshape data to long format\nweights &lt;- tidyr::pivot_longer(\n  weights,\n  cols = c('negative_exp',  'logistic'),\n  names_to = \"decay_function\",\n  values_to = \"weights\"\n)\n\nggplot(weights) +\n  geom_line(aes(minutes, weights, color = decay_function),\n            show.legend = FALSE) +\n  facet_wrap(. ~ decay_function, ncol = 2) +\n  theme_minimal()",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>Aborgadem flexivel</span>"
    ]
  },
  {
    "objectID": "3.2_flexible_approach.html#accessibility-map",
    "href": "3.2_flexible_approach.html#accessibility-map",
    "title": "5¬† Aborgadem flexivel",
    "section": "5.4 Accessibility map",
    "text": "5.4 Accessibility map\nNow it is super simple to merge all of these accessibility estimates to our spatial grid to visualize these results on a map.\n\n# rbind all accessibility results in a single data.frame\naccess_cum_t$metric &lt;- 'cum_threshold'\naccess_cum_i$metric &lt;- 'cum_interval'\naccess_lgst$metric &lt;- 'grav_logistic'\naccess_nexp$metric &lt;- 'grav_exponential'\n\ndf &lt;- rbind(access_cum_t,\n            access_cum_i,\n            access_lgst,\n            access_nexp\n            )\n\n# retrieve polygons of H3 spatial grid\ngrid &lt;- h3jsr::cell_to_polygon(\n  points$id, \n  simple = FALSE\n  )\n\n# merge accessibility estimates\naccess_sf &lt;- left_join(\n  grid, \n  df, \n  by = c('h3_address'='id')\n  )\n\nPlot map\n\nggplot() +\n  geom_sf(data = access_sf, aes(fill = schools), color= NA) +\n  scale_fill_viridis_c(direction = -1, option = 'B') +\n  labs(title = \"Access to schools by public transport using different accessibility metrics\", fill = \"Access\\nscore\") +\n  theme_minimal() +\n  theme(axis.title = element_blank()) +\n  facet_wrap(~metric) +\n  theme_void()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe {r5r} package has several advanced capabilities:\n\nAccounting for monetary costs\nAccounting for Level of Traffic Stress (LTS)\nUsing a departure window period instead of an exact departure time\nTrip planning with detailed ouputs\nCalculating isochrones\nGenerating larger-than-memory outputs\n\nSee the package vignettes on the website fore more info.\n\n\n\n\n\n\n\nConway, Matthew Wigginton, Andrew Byrd, and Marco van der Linden. 2017. ‚ÄúEvidence-Based Transit and Land Use Sketch Planning Using Interactive Accessibility Methods on Combined Schedule and Headway-Based Networks.‚Äù Transportation Research Record: Journal of the Transportation Research Board 2653 (1): 45‚Äì53. https://doi.org/10.3141/2653-06.\n\n\nHiggins, Christopher, Matthew Palm, Amber DeJohn, Luna Xi, James Vaughan, Steven Farber, Michael Widener, and Eric Miller. 2022. ‚ÄúCalculating Place-Based Transit Accessibility: Methods, Tools and Algorithmic Dependence.‚Äù Journal of Transport and Land Use 15 (1). https://doi.org/10.5198/jtlu.2022.2012.\n\n\nPereira, Rafael H. M. 2019. ‚ÄúFuture Accessibility Impacts of Transport Policy Scenarios: Equity and Sensitivity to Travel Time Thresholds for Bus Rapid Transit Expansion in Rio de Janeiro.‚Äù Journal of Transport Geography 74: 321‚Äì32. https://doi.org/https://doi.org/10.1016/j.jtrangeo.2018.12.005.\n\n\nTomasiello, Diego Bogado, Daniel Herszenhut, Jo√£o Lucas Albuquerque Oliveira, Carlos Kaue Vieira Braga, and Rafael H. M. Pereira. 2023. ‚ÄúA Time Interval Metric for Cumulative Opportunity Accessibility.‚Äù Applied Geography 157 (August): 103007. https://doi.org/10.1016/j.apgeog.2023.103007.",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>Aborgadem flexivel</span>"
    ]
  },
  {
    "objectID": "3.3_equity_measures.html",
    "href": "3.3_equity_measures.html",
    "title": "6¬† Equity measures",
    "section": "",
    "text": "7 Inequality measures",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>6</span>¬† <span class='chapter-title'>Equity measures</span>"
    ]
  },
  {
    "objectID": "3.3_equity_measures.html#palma-ratio",
    "href": "3.3_equity_measures.html#palma-ratio",
    "title": "6¬† Equity measures",
    "section": "7.1 Palma ratio",
    "text": "7.1 Palma ratio\nThe Palma ratio is calculated as the average access of the richest 10% divided by the average access of the poorest 40%. Palma Ratio values higher than 1 indicate that the wealthiest population has higher accessibility levels than the poorest, whereas values lower than 1 indicate the opposite situation.\nIn the example here, we see that the wealthiest population can access on average 3.8 times more jobs than the poor population.\n\npalma &lt;- palma_ratio(\n  accessibility_data = access_df,\n  sociodemographic_data = lud,\n  opportunity = \"jobs\",\n  population = \"population\",\n  income = \"income_per_capita\"\n  )\n\npalma\n\n   palma_ratio\n         &lt;num&gt;\n1:    3.800465",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>6</span>¬† <span class='chapter-title'>Equity measures</span>"
    ]
  },
  {
    "objectID": "3.3_equity_measures.html#concentration-index",
    "href": "3.3_equity_measures.html#concentration-index",
    "title": "6¬† Equity measures",
    "section": "7.2 Concentration index",
    "text": "7.2 Concentration index\nThe concentration index (CI) estimates the extent to which accessibility inequalities are systematically associated with individuals‚Äô socioeconomic levels. CI values can theoretically vary between -1 and 1 (when all accessibility is concentrated in the most or in the least disadvantaged person, respectively). Negative values indicate that inequalities favor the poor, while positive values indicate a pro-rich bias.\n\nci &lt;- accessibility::concentration_index(\n  accessibility_data = access_df,\n  sociodemographic_data = lud,\n  opportunity = \"jobs\",\n  population = \"population\",\n  income = \"income_per_capita\",\n  type = \"corrected\"\n  )\n\nci\n\n   concentration_index\n                 &lt;num&gt;\n1:           0.3346494",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>6</span>¬† <span class='chapter-title'>Equity measures</span>"
    ]
  },
  {
    "objectID": "3.3_equity_measures.html#gini-index",
    "href": "3.3_equity_measures.html#gini-index",
    "title": "6¬† Equity measures",
    "section": "7.3 Gini index",
    "text": "7.3 Gini index\nYou probably shouldn‚Äôt use the Gini index to measure accessibility inequality (see Karner, Pereira, and Farber 2024).",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>6</span>¬† <span class='chapter-title'>Equity measures</span>"
    ]
  },
  {
    "objectID": "3.3_equity_measures.html#foster-greer-thorbecke-fgt-poverty-measures",
    "href": "3.3_equity_measures.html#foster-greer-thorbecke-fgt-poverty-measures",
    "title": "6¬† Equity measures",
    "section": "8.1 Foster-Greer-Thorbecke (FGT) poverty measures",
    "text": "8.1 Foster-Greer-Thorbecke (FGT) poverty measures\nThe fgt_poverty() function calculates the FGT metrics, a family of poverty measures originally proposed by Foster, Greer, and Thorbecke (1984), and which that can be used to capture the extent and severity of poverty within an accessibility distribution. The FGT family is composed of three measures:\n\nFGT0: it captures the extent of poverty as a simple headcount - i.e.¬†the proportion of people below the poverty line;\nFGT1: also know as the ‚Äúpoverty gap index‚Äù, it captures the severity of poverty as the average percentage distance between the poverty line and the accessibility of individuals below the poverty line;\nFGT2: it simultaneously captures the extent and the severity of poverty by calculating the number of people below the poverty line weighted by the size of the accessibility shortfall relative to the poverty line.\n\nThis function includes an additional poverty_line parameter, used to define the poverty line below which individuals are considered to be in accessibility poverty. For the sake of this exercise, we‚Äôll consider the lowest 25th percentile of access as our poverty line, which in this example is approximately 23 thousand jobs.\n\n\n\n\n\n\nQuick reminder that the definition of an accessibility poverty line is ultimately a moral and political decision and not simply an empirical or technical question (Pereira, Schwanen, and Banister 2017; Lucas et al. 2019).\n\n\n\n\n# get the 25th percentile of access\nquant25 &lt;- quantile(access_df$jobs, .25)\n\npoverty &lt;- fgt_poverty(\n  accessibility_data =  access_df,\n  sociodemographic_data = lud,\n  opportunity = \"jobs\",\n  population = \"population\",\n  poverty_line = quant25\n  )\n\npoverty\n\n        FGT0       FGT1       FGT2\n       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;\n1: 0.1478675 0.04948043 0.02862334\n\n\nQuick interpretation:\n\nFGT0: 14.8% of the population are in accessibility poverty\nFGT1: the accessibility of those living in accessibility poverty is on average 5% lower than the poverty line\nFGT2: it has no clear interpretation, but one could say that the overall poverty level/intensity is 2.8%.\n\n\n\n\n\nFoster, James, Joel Greer, and Erik Thorbecke. 1984. ‚ÄúA Class of Decomposable Poverty Measures.‚Äù Econometrica 52 (3): 761‚Äì66. https://doi.org/10.2307/1913475.\n\n\nKarner, Alex, Rafael H. M. Pereira, and Steven Farber. 2024. ‚ÄúAdvances and Pitfalls in Measuring Transportation Equity.‚Äù Transportation, January. https://doi.org/10.1007/s11116-023-10460-7.\n\n\nLucas, Karen, Karel Martens, Floridea Di Ciommo, and Ariane Dupont-Kieffer. 2019. Measuring Transport Equity. Elsevier.\n\n\nPereira, Rafael H. M., Tim Schwanen, and David Banister. 2017. ‚ÄúDistributive Justice and Equity in Transportation.‚Äù Transport Reviews 37 (2): 170‚Äì91. https://doi.org/10.1080/01441647.2016.1257660.",
    "crumbs": [
      "3. Calculando acessibilidade",
      "<span class='chapter-number'>6</span>¬† <span class='chapter-title'>Equity measures</span>"
    ]
  }
]