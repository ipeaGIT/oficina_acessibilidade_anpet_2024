{
  "hash": "55946e8b47bcaf9e15deb7c927127df0",
  "result": {
    "engine": "knitr",
    "markdown": "#  Dados do Projeto Acesso a Oportunidades\n\nNos capítulos anteriores, aprendemos como calcular medidas de acessibilidade urbana usando R. Nesta última parte da oficina, apresentaremos a base de dados com estimativas de acessibilidade criada e disponibilizada pelo [Lab de Acesso a Oportunidades](https://www.ipea.gov.br/acessooportunidades/) (AOP) do Ipea. O pacote `{aopdata}` permite baixar, por exemplo, estimativas de acesso a empregos e a serviços de saúde, de educação e de assistência social para 2017, 2018 e 2019 nas maiores cidades do Brasil.\n\n::: {.callout-important appearance=\"simple\"}\nEm breve o projeto será atualizado e expandido para mais cidades.\n:::\n\nTodas as bases de dados criadas pelo projeto AOP estão disponíveis para *download* em seu [*site*](https://www.ipea.gov.br/acessooportunidades/dados/) ou pelo pacote de R `{aopdata}`. O dicionário de dados pode ser acessado *online*[^aop_data_dictionary] ou, em uma sessão de R, com o comando `aopdata::aopdata_dictionary(lang = \"pt\")`.\n\nAs estimativas de acessibilidade podem ser baixadas com a função `aopdata::read_access()`, que funciona de maneira análoga à outras funções do pacote `read_population()` e `read_landuse()`. Além de indicar a cidade (parâmetro `city`) e o ano de referência (`year`), no entanto, é necessário também informar o modo de transporte (`mode`) e o intervalo do dia (pico, entre 6h e 8h, ou fora-pico, entre 14h e 16h, controlado pelo parâmetro `peak`).\n\nNo exemplo a seguir, mostramos como baixar estimativas de acessibilidade no período de pico em São Paulo referentes a 2019. Nesse exemplo, baixamos as estimativas de acessibilidade tanto por automóvel quanto por transporte público e as unimos em um único `data.frame`. Note que essa função resulta em uma tabela que traz também, automaticamente, os dados de população e de uso do solo.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(aopdata)\n\n# baixa dados do AOP de acessibilidade por transporte público\nacesso_tp <- aopdata::read_access(\n  city = \"São Paulo\",\n  mode = \"public_transport\",\n  year = 2019,\n  peak = TRUE,\n  geometry = TRUE,\n  showProgress = FALSE\n)\n\n# baixa dados do AOP de acessibilidade por automóvel\nacesso_carro <- aopdata::read_access(\n  city = \"São Paulo\",\n  mode = \"car\",\n  year = 2019,\n  peak = TRUE,\n  geometry = TRUE,\n  showProgress = FALSE\n)\n\n# junta os dados em um único dataframe\ndados_sp <- rbind(acesso_tp, acesso_carro)\n\nnames(dados_sp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  [1] \"id_hex\"       \"abbrev_muni\"  \"name_muni\"    \"code_muni\"    \"year\"        \n  [6] \"P001\"         \"P002\"         \"P003\"         \"P004\"         \"P005\"        \n [11] \"P006\"         \"P007\"         \"P010\"         \"P011\"         \"P012\"        \n [16] \"P013\"         \"P014\"         \"P015\"         \"P016\"         \"R001\"        \n [21] \"R002\"         \"R003\"         \"T001\"         \"T002\"         \"T003\"        \n [26] \"T004\"         \"E001\"         \"E002\"         \"E003\"         \"E004\"        \n [31] \"M001\"         \"M002\"         \"M003\"         \"M004\"         \"S001\"        \n [36] \"S002\"         \"S003\"         \"S004\"         \"C001\"         \"mode\"        \n [41] \"peak\"         \"CMATT15\"      \"CMATB15\"      \"CMATM15\"      \"CMATA15\"     \n [46] \"CMAST15\"      \"CMASB15\"      \"CMASM15\"      \"CMASA15\"      \"CMAET15\"     \n [51] \"CMAEI15\"      \"CMAEF15\"      \"CMAEM15\"      \"CMAMT15\"      \"CMAMI15\"     \n [56] \"CMAMF15\"      \"CMAMM15\"      \"CMACT15\"      \"CMPPT15\"      \"CMPPH15\"     \n [61] \"CMPPM15\"      \"CMPPB15\"      \"CMPPA15\"      \"CMPPI15\"      \"CMPPN15\"     \n [66] \"CMPP0005I15\"  \"CMPP0614I15\"  \"CMPP1518I15\"  \"CMPP1924I15\"  \"CMPP2539I15\" \n [71] \"CMPP4069I15\"  \"CMPP70I15\"    \"CMATT30\"      \"CMATB30\"      \"CMATM30\"     \n [76] \"CMATA30\"      \"CMAST30\"      \"CMASB30\"      \"CMASM30\"      \"CMASA30\"     \n [81] \"CMAET30\"      \"CMAEI30\"      \"CMAEF30\"      \"CMAEM30\"      \"CMAMT30\"     \n [86] \"CMAMI30\"      \"CMAMF30\"      \"CMAMM30\"      \"CMACT30\"      \"CMPPT30\"     \n [91] \"CMPPH30\"      \"CMPPM30\"      \"CMPPB30\"      \"CMPPA30\"      \"CMPPI30\"     \n [96] \"CMPPN30\"      \"CMPP0005I30\"  \"CMPP0614I30\"  \"CMPP1518I30\"  \"CMPP1924I30\" \n[101] \"CMPP2539I30\"  \"CMPP4069I30\"  \"CMPP70I30\"    \"CMATT60\"      \"CMATB60\"     \n[106] \"CMATM60\"      \"CMATA60\"      \"CMAST60\"      \"CMASB60\"      \"CMASM60\"     \n[111] \"CMASA60\"      \"CMAET60\"      \"CMAEI60\"      \"CMAEF60\"      \"CMAEM60\"     \n[116] \"CMAMT60\"      \"CMAMI60\"      \"CMAMF60\"      \"CMAMM60\"      \"CMACT60\"     \n[121] \"CMPPT60\"      \"CMPPH60\"      \"CMPPM60\"      \"CMPPB60\"      \"CMPPA60\"     \n[126] \"CMPPI60\"      \"CMPPN60\"      \"CMPP0005I60\"  \"CMPP0614I60\"  \"CMPP1518I60\" \n[131] \"CMPP1924I60\"  \"CMPP2539I60\"  \"CMPP4069I60\"  \"CMPP70I60\"    \"CMATT90\"     \n[136] \"CMATB90\"      \"CMATM90\"      \"CMATA90\"      \"CMAST90\"      \"CMASB90\"     \n[141] \"CMASM90\"      \"CMASA90\"      \"CMAET90\"      \"CMAEI90\"      \"CMAEF90\"     \n[146] \"CMAEM90\"      \"CMAMT90\"      \"CMAMI90\"      \"CMAMF90\"      \"CMAMM90\"     \n[151] \"CMACT90\"      \"CMPPT90\"      \"CMPPH90\"      \"CMPPM90\"      \"CMPPB90\"     \n[156] \"CMPPA90\"      \"CMPPI90\"      \"CMPPN90\"      \"CMPP0005I90\"  \"CMPP0614I90\" \n[161] \"CMPP1518I90\"  \"CMPP1924I90\"  \"CMPP2539I90\"  \"CMPP4069I90\"  \"CMPP70I90\"   \n[166] \"CMATT120\"     \"CMATB120\"     \"CMATM120\"     \"CMATA120\"     \"CMAST120\"    \n[171] \"CMASB120\"     \"CMASM120\"     \"CMASA120\"     \"CMAET120\"     \"CMAEI120\"    \n[176] \"CMAEF120\"     \"CMAEM120\"     \"CMAMT120\"     \"CMAMI120\"     \"CMAMF120\"    \n[181] \"CMAMM120\"     \"CMACT120\"     \"CMPPT120\"     \"CMPPH120\"     \"CMPPM120\"    \n[186] \"CMPPB120\"     \"CMPPA120\"     \"CMPPI120\"     \"CMPPN120\"     \"CMPP0005I120\"\n[191] \"CMPP0614I120\" \"CMPP1518I120\" \"CMPP1924I120\" \"CMPP2539I120\" \"CMPP4069I120\"\n[196] \"CMPP70I120\"   \"TMIST\"        \"TMISB\"        \"TMISM\"        \"TMISA\"       \n[201] \"TMIET\"        \"TMIEI\"        \"TMIEF\"        \"TMIEM\"        \"TMICT\"       \n[206] \"geometry\"    \n```\n\n\n:::\n:::\n\n\n\n\nComo podemos ver, assim como nos casos das tabelas de dados sociodemográficos e de uso do solo, os nomes das variáveis de estimativas de acessibilidade estão organizados em códigos, como `CMAEF30`, `TMISB` e `CMPPM60`. Esses códigos são resultado da combinação de três componentes, conforme descrito a seguir.\n\n1. O **tipo de indicador** de acessibilidade: é indicado pelas três primeiras letras do código. Os dados incluem três categorias de indicadores:\n\n   - `CMA` - indicador de acessibilidade cumulativa ativa;\n   - `CMP` - indicador de acessibilidade cumulativa passiva; e\n   - `TMI` - indicador de tempo mínimo até a oportunidade mais próxima.\n\n2. O **tipo de atividade** para a qual os níveis de acessibilidade foram calculados ou a que pessoas o indicador se refere: é descrito pelas letras seguintes, que estão no meio do código. Os dados incluem estimativas de acessibilidade para diversos tipos de atividades:\n\n   - `TT` - todos os empregos;\n   - `TB` - empregos de baixa escolaridade;\n   - `TM` - empregos de média escolaridade;\n   - `TA` - empregos de alta escolaridade;\n   - `ST` - todos os estabelecimentos públicos de saúde;\n   - `SB` - estabelecimentos públicos de saúde de baixa complexidade;\n   - `SM` - estabelecimentos públicos de saúde de média complexidade;\n   - `SA` - estabelecimentos públicos de saúde de alta complexidade;\n   - `ET` - todas as escolas públicas;\n   - `EI` - escolas públicas de ensino infantil;\n   - `EF` - escolas públicas de ensino fundamental;\n   - `EM` - escolas públicas de ensino médio;\n   - `MT` - todas as matrículas de escolas públicas;\n   - `MI` - matrículas de escolas públicas de ensino infantil;\n   - `MF` - matrículas de escolas públicas de ensino fundamental;\n   - `MM` - matrículas de escolas públicas de ensino médio; e\n   - `CT` - todos os CRAS.\n\nNo caso do indicador de acessibilidade passiva, as letras no meio do nome da variável indicam **a qual grupo populacional** os níveis de acessibilidade se referem:\n\n   - `PT` - toda a população;\n   - `PH` - população de homens;\n   - `PM` - população de mulheres;\n   - `PB` - população branca;\n   - `PN` - população negra;\n   - `PA` - população amarela;\n   - `PI` - população indígena;\n   - `P0005I` - população de 0 a 5 anos;\n   - `P0614I` - população de 6 a 14 anos;\n   - `P1518I` - população de 15 a 18 anos;\n   - `P1924I` - população de 19 a 24 anos;\n   - `P2539I` - população de 25 a 39 anos;\n   - `P4069I` - população de 40 a 69 anos; e\n   - `P70I` - população de 70 anos ou mais.\n\n3. O **tempo limite de viagem** utilizado no cálculo do indicador: é descrito pelos números ao final do código. Esses números somente se aplicam aos indicadores de acessibilidade cumulativa ativa e passiva e incluem os limites de 15, 30, 45, 60, 90 e 120 minutos, dependendo do modo de transporte.\n\n**Exemplos:**\n\n- <span style=\"color: red;\">CMA</span><span style=\"color: black;\">EF</span><span style=\"color: blue;\">30</span>: número de escolas públicas de ensino fundamental acessíveis em até 30 minutos de viagem;\n- <span style=\"color: red;\">TMI</span><span style=\"color: black;\">SB</span>: tempo de viagem até o estabelecimento público de saúde com serviços de baixa complexidade mais próximo; e\n- <span style=\"color: red;\">CMP</span><span style=\"color: black;\">PM</span><span style=\"color: blue;\">60</span>: quantidade de mulheres que conseguem acessar determinada célula da grade espacial em até 60 minutos de viagem.\n\nA descrição completa das variáveis também pode ser consultada na documentação da função, rodando em uma sessão de R o comando `?read_access`. As subseções a seguir mostram exemplos de visualizações desses dados em forma de mapas e gráficos.\n\n## Mapa do tempo para acessar o hospital mais próximo\n\nNeste exemplo, comparamos o tempo de acesso por automóvel e por transporte público até o hospital mais próximo de cada hexágono. Para analisar o tempo mínimo de viagem (`TMI`) até hospitais de alta complexidade (`SA`), utilizamos a variável `TMISA`. Com o código a seguir, carregamos as bibliotecas de visualização de dados e apresentamos a distribuição espacial do tempo de acesso com os dois modos de transporte. Como os tempos de viagem por transporte público costumam ser muito mais longos do que por automóvel, truncamos a distribuição dos valores da variável em sessenta minutos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(patchwork)\n\n# trunca os tempos de viagem em 60 minutos\ndados_sp$TMISA <- ifelse(dados_sp$TMISA > 60, 60, dados_sp$TMISA)\n\nggplot(subset(dados_sp, !is.na(mode))) +\n  geom_sf(aes(fill = TMISA), color = NA, alpha = 0.9) +\n  scale_fill_viridis_c(\n    option = \"cividis\",\n    direction = -1,\n    breaks = seq(0, 60, 10),\n    labels = c(seq(0, 50, 10), \"60+\")\n  ) +\n  labs(fill = \"Tempo (em\\nminutos)\") +\n  facet_wrap(\n    ~ mode,\n    labeller = as_labeller(\n      c(car = \"Carro\", public_transport = \"Transporte público\")\n    )\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![Tempo de viagem até o hospital de alta complexidade mais próximo em São Paulo](4_aopdata_acessibilidade_files/figure-html/fig-time_to_hospital-1.png){#fig-time_to_hospital width=672}\n:::\n:::\n\n\n\n\n## Mapa da quantidade de empregos acessíveis\n\nOs dados do `{aopdata}` também tornam muito simples a comparação da quantidade de oportunidades acessíveis em diferentes tempos de viagem. Com o código a seguir, por exemplo, ilustramos como visualizar lado a lado as distribuições espaciais do número de empregos acessíveis em até sessenta e noventa minutos de viagem, respectivamente, por transporte público.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# estabelece valores usados na legenda do mapa\nlimites_legenda <- c(0, max(acesso_tp$CMATT90, na.rm = TRUE) / 1000000)\n\n# configura os mapas\n\nfig60 <- ggplot(subset(acesso_tp, !is.na(mode))) +\n  geom_sf(aes(fill = CMATT60 / 1000000), color = NA, alpha = 0.9) +\n  scale_fill_viridis_c(option = \"inferno\", limits = limites_legenda) +\n  labs(\n    subtitle = \"Até sessenta minutos de viagem\",\n    fill = \"Empregos\\n(em milhões)\"\n  ) +\n  theme_void()\n\nfig90 <- ggplot(subset(acesso_tp, !is.na(mode))) +\n  geom_sf(aes(fill = CMATT90 / 1000000), color = NA, alpha = 0.9) +\n  scale_fill_viridis_c(option = \"inferno\", limits = limites_legenda) +\n  labs(\n    subtitle = \"Até noventa minutos de viagem\",\n    fill = \"Empregos\\n(em milhões)\"\n  ) +\n  theme_void()\n\nfig60 + fig90 + plot_layout(guides = \"collect\")\n```\n\n::: {.cell-output-display}\n![Quantidade de empregos acessíveis por transporte público em São Paulo](4_aopdata_acessibilidade_files/figure-html/fig-accessible_jobs-1.png){#fig-accessible_jobs width=672}\n:::\n:::\n\n\n\n\n## Desigualdades de acesso a oportunidades\n\nExistem diversas maneiras de analisar quão desiguais são as condições de acesso a oportunidades nas cidades brasileiras a partir dos dados do `{aopdata}`. Nesta subseção, apresentamos três exemplos deste tipo de análise.\n\n### Desigualdade no tempo de acesso a oportunidades\n\nNeste primeiro exemplo, vamos comparar o tempo médio de viagem até o hospital público mais próximo de pessoas de diferentes níveis de renda. Para isso, calculamos o tempo médio de acesso a estabelecimentos de saúde de alta complexidade ponderado pela população de cada célula da nossa grade espacial. Essa ponderação é necessária porque cada célula, por abrigar um número de pessoas diferente das demais, contribui de forma diferente para a média da população como um todo.\n\nAntes de realizar o cálculo, cabe observar que algumas células da cidade não conseguem acessar nenhum hospital em até duas horas de viagem. Nesses casos, o valor das variáveis de tempo mínimo de viagem é infinito (`Inf`). Para lidar com isso, neste exemplo substituímos todos os valores `Inf` por um tempo de viagem de 120 minutos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# copia os dados de acesso em um novo dataframe\ndesigualdade_tp <- data.table::as.data.table(acesso_tp)\n\n# substitui os valores Inf por 120\ndesigualdade_tp[, TMISA := ifelse(is.infinite(TMISA), 120, TMISA)]\n\n# calcula o tempo de viagem médio por decil de renda\ndesigualdade_tp <- desigualdade_tp[\n  ,\n  .(media = weighted.mean(x = TMISA, w = P001, na.rm = TRUE)),\n  by = R003\n]\ndesigualdade_tp <- subset(desigualdade_tp, !is.na(media))\n\nggplot(desigualdade_tp) +\n  geom_col(aes(y = media, x = factor(R003)), fill = \"#2c9e9e\", color = NA) +\n  scale_x_discrete(\n    labels = c(\"D1\\nmais\\npobres\", paste0(\"D\", 2:9), \"D10\\nmais\\nricos\")\n  ) +\n  labs(x = \"Decil de renda\", y = \"Tempo de viagem (em minutos)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![Média de tempo de viagem por transporte público em São Paulo até o hospital mais próximo](4_aopdata_acessibilidade_files/figure-html/fig-time_to_hospital_by_income-1.png){#fig-time_to_hospital_by_income width=672}\n:::\n:::\n\n\n\n\n### Desigualdade no número de oportunidades acessíveis\n\nOutra maneira de examinar a desigualdade de acesso a oportunidades é comparar a quantidade de oportunidades acessíveis por diferentes grupos populacionais considerando os mesmos modos de transporte e limites de tempo de viagem. Nesse caso, analisamos o indicador de acessibilidade cumulativa ativa, representado por variáveis cujos códigos começam com `CMA` na base de dados do `{aopdata}`. No exemplo a seguir, comparamos a quantidade de empregos acessíveis por pessoas de diferentes decis de renda, considerando viagens de transporte público limitadas em sessenta minutos de viagem.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(subset(acesso_tp, !is.na(R003))) +\n  geom_boxplot(\n    aes(x = factor(R003), y = CMATT60 / 1000000, color = factor(R003))\n  ) +\n  scale_color_brewer(palette = \"RdBu\") +\n  labs(\n    color = \"Decil\\nde renda\",\n    x = \"Decil de renda\",\n    y = \"Empregos acessíveis (em milhões)\"\n  ) +\n  scale_x_discrete(\n    labels = c(\"D1\\nmais\\npobres\", paste0(\"D\", 2:9), \"D10\\nmais\\nricos\")\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![Distribuição do número de empregos acessíveis por transporte público em São Paulo](4_aopdata_acessibilidade_files/figure-html/fig-accessible_jobs_by_income-1.png){#fig-accessible_jobs_by_income width=672}\n:::\n:::\n\n\n\n\nPor fim, podemos também comparar como o uso de diferentes modos de transporte resulta em diferentes níveis de acessibilidade para a população e como essa diferença varia entre cidades. No exemplo a seguir, comparamos a quantidade de empregos acessíveis em até trinta minutos de viagem a pé e de carro. Para isso, precisamos primeiro baixar os dados de acessibilidade por ambos os modos para todas as cidades do projeto.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados_carro <- aopdata::read_access(\n  city = \"all\",\n  mode = \"car\",\n  year = 2019,\n  showProgress = FALSE\n)\n\ndados_caminhada <- aopdata::read_access(\n  city = \"all\",\n  mode = \"walk\",\n  year = 2019,\n  showProgress = FALSE\n)\n```\n:::\n\n\n\n\nEm seguida, calculamos para cada cidade e para cada modo de transporte a média ponderada do número de empregos acessíveis em até trinta minutos (`CMATT30`). Feito isso, juntamos essas estimativas em uma única tabela e calculamos a razão entre os níveis de acessibilidade por carro e os níveis de acessibilidade a pé.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# calcula a média de empregos acessíveis em 30 minutos\n\nmedia_carro <- dados_carro[\n  ,\n  .(acesso_carro = weighted.mean(CMATT30, w = P001, na.rm = TRUE)),\n  by = name_muni\n]\n\nmedia_caminhada <- dados_caminhada[\n  ,\n  .(acesso_caminhada = weighted.mean(CMATT30, w = P001, na.rm = TRUE)),\n  by = name_muni\n]\n\n# junta os dados e calcula a razão entre o nível de acesso por carro e a pé\nmedia_acesso <- merge(media_carro, media_caminhada)\nmedia_acesso[, razao := acesso_carro / acesso_caminhada]\n\nhead(media_acesso)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nKey: <name_muni>\n        name_muni acesso_carro acesso_caminhada    razao\n           <char>        <num>            <num>    <num>\n1:          Belem     155270.4         9392.235 16.53179\n2: Belo Horizonte     529890.0        12464.233 42.51284\n3:       Brasilia     220575.9         4110.703 53.65892\n4:       Campinas     256333.1         6748.923 37.98133\n5:   Campo Grande     172680.5         4181.209 41.29919\n6:       Curitiba     494376.9        10471.135 47.21331\n```\n\n\n:::\n:::\n\n\n\n\nFinalmente, podemos visualizar os resultados graficamente:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(media_acesso, aes(x = razao, y = reorder(name_muni, razao))) +\n  geom_bar(stat = \"identity\") +\n  geom_text(aes(x = razao + 3 , label = paste0(round(razao), \"x\"))) +\n  labs(y = NULL, x = \"Razão entre a acessibilidade de carro e a pé\") +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![Diferença entre a quantidade de empregos acessíveis por automóvel e por caminhada em até trinta minutos de viagem nas vinte maiores cidades do Brasil](4_aopdata_acessibilidade_files/figure-html/fig-car_walk_ratio-1.png){#fig-car_walk_ratio width=672}\n:::\n:::\n\n\n\n\nComo esperado, a @fig-car_walk_ratio mostra que é possível acessar muito mais empregos em até 30 minutos com viagens de carro do que com viagens a pé. Essa diferença, porém, varia muito entre cidades. Em São Paulo e em Brasília, viagens de automóvel de até trinta minutos permitem acessar, em média, um número de empregos 54 vezes maior do que viagens a pé de mesma duração. Em Belém, onde observamos a menor diferença, o automóvel permite acessar 17 vezes mais empregos do que a caminhada - razão ainda considerável, porém menor do que a das demais cidades.",
    "supporting": [
      "4_aopdata_acessibilidade_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}